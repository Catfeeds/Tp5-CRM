{include file='layout/header'}
<div class="col-sm-12">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>职位部门 <small>分类，查找</small></h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#">
                    <i class="fa fa-wrench"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="table_data_tables.html#">选项1</a>
                    </li>
                    <li><a href="table_data_tables.html#">选项2</a>
                    </li>
                </ul>
                <a class="close-link">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">

            <!--成功-->
            <div class="modal " tabindex="-1"  id="ok" data-backdrop="static" >
                <div class="modal-dialog" style="width: 180px;">
                    <!-- 内容声明 -->
                    <div class="modal-content">
                        <!-- 头部 -->
                        <!-- 主体 -->
                        <div class="modal-body">
                            <img src="__IMG__/loading.gif" alt="" style="margin-left: -20px;" id="ok-img" > <span id="ok-text">&nbsp;&nbsp;数据交互中...</span>
                        </div>
                        <!-- 注脚 -->

                    </div>
                </div>
            </div>

            <!--add-->
            <div class="modal" tabindex="-1"  id="myModal" data-backdrop="static" >
                <div class="modal-dialog" style="width: 900px;">
                    <!-- 内容声明 -->
                    <div class="modal-content">
                        <!-- 头部 -->
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title"> <span class="glyphicon glyphicon-plus"> 发送私信</span>  </h4>
                        </div>
                        <!-- 主体 -->
                        <div class="modal-body">
                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class=" control-label col-sm-2">收件人：</label>
                                    <div class="col-sm-10">
                                        <div class=" input-group">
                                            <input type="text" class="form-control "  id="allo"  readonly style="background-color: white"  >
                                            <div class="input-group-addon" id="test"><span class="glyphicon glyphicon-search"></span></div>
                                        </div>
                                    </div>

                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">私信内容：</label>
                                    <div class="col-sm-10">
                                        <textarea name="content" class="common-textarea" id="content" cols="30" style="width: 98%; " rows="10"></textarea>      </div>
                                </div>
                            </form>
                        </div>

                        <!-- 注脚 -->
                        <div class="modal-footer">
                            <a   class="btn btn-primary"  id="submit" > <span class="glyphicon glyphicon-ok">保存</span>  </a>
                            <a  class="btn btn-danger" style="margin-top: -5px;" data-dismiss="modal" > <span class="glyphicon glyphicon-remove">取消</span></a>
                        </div>
                    </div>
                </div>
            </div>

            <!--extend-->
            <div class="modal" tabindex="-1"  id="product" data-backdrop="static" >
                <div class="modal-dialog">
                    <!-- 内容声明 -->
                    <div class="modal-content"  style="width: 750px;">
                        <!-- 头部 -->
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title"> <span class="glyphicon glyphicon-plus"> 选择收件人</span>  </h4>
                        </div>
                        <!-- 主体 -->
                        <div class="modal-body" style="overflow: auto;max-height: 550px;" >
                            <div class="form-horizontal">
                                <table class="table table-hover table-bordered">
                                    <thead>
                                    <tr >
                                        <th class="text-center">ID</th>
                                        <th  class="text-center">员工编号</th>
                                        <th  class="text-center">员工名称</th>
                                        <th  class="text-center">性别</th>
                                        <th  class="text-center">员工类型</th>
                                        <th  class="text-center">选择员工</th>
                                    </tr>
                                    </thead>
                                    <tbody class="text-center" id="add-ok">
                                    {volist name='staffData' id='value'}
                                    <tr>
                                        <td>{$value.id}</td>
                                        <td>{$value.number}</td>
                                        <td>{$value.name}</td>
                                        <td>{$value.gender}</td>
                                        <td>{$value.type}</td>
                                        <td  class="documentary"><span class="glyphicon glyphicon-ok"> 选择</span></td>
                                    </tr>
                                    {/volist}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- 注脚 -->
                    </div>
                </div>
            </div>



            <!--update-->
            <div class="modal " tabindex="-1"  id="myModals" data-backdrop="static" >
                <div class="modal-dialog">
                    <!-- 内容声明 -->
                    <div class="modal-content" style="width: 750px;max-height: 700px;overflow: auto">
                        <!-- 头部 -->
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title"> <span class="glyphicon glyphicon-plus"> 更新工作阶段</span>  </h4>
                        </div>
                        <!-- 主体 -->
                        <div class="modal-body">
                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">工作名称</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control "   style="background-color: white" readonly id="titles" >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">工作类型</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control "   style="background-color: white" readonly id="types" >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">开始时间</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control "  readonly  id="start_dates" style="background-color: white" >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">结束时间</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control "  readonly  id="end_dates" style="background-color: white" >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">完成阶段：</label>
                                    <div class="col-sm-10">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th style="width: 4%"></th>
                                                <th class="text-center">完成阶段</th>
                                                <th class="text-center">创建时间</th>
                                            </tr>
                                            </thead>
                                            <tbody id="adds_ok">

                                            </tbody>
                                        </table>
                                        <button id="set_ok" class="btn btn-outline btn-primary dim" type="button"><i class="fa fa-check">设置完成</i>
                                        </button>

                                        <button id="clears" style="float: right" class="btn btn-outline btn-danger dim " type="button"><i class="glyphicon glyphicon-remove"> 取消</i>
                                        </button>

                                        <button  id="adds" style="float: right" class="btn btn-outline btn-success dim" type="button"><i class="glyphicon glyphicon-plus"> 添加</i>
                                        </button>

                                        <button id="oks" style="float: right" class="btn btn-outline btn-success dim " type="button"><i class="glyphicon glyphicon-plus" > 保存</i>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!-- 注脚 -->
                        <div class="modal-footer">
                            <a  class="btn btn-danger" style="margin-top: -5px;" data-dismiss="modal" > <span class="glyphicon glyphicon-remove">取消</span></a>
                        </div>
                    </div>
                </div>
            </div>


            <!--list-->
            <div class="modal" tabindex="-1"  id="myModalss" data-backdrop="static" >
                <div class="modal-dialog">
                    <!-- 内容声明 -->
                    <div class="modal-content" style="width: 750px; ">
                        <!-- 头部 -->
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title"> <span class="glyphicon glyphicon-plus"> 详情</span>  </h4>
                        </div>
                        <!-- 主体 -->
                        <div class="modal-body" style="max-height: 500px;overflow: auto">
                            <table class="table table-hover table-bordered text-center">
                                <tr>
                                    <th colspan="5" align="left"> 详情</th>
                                </tr>
                                <tr>
                                    <td width="15%">发件人：</td>
                                    <td width="80%"  id="list-send_name"></td>
                                </tr>

                                <tr>
                                    <td>发件时间：</td>
                                    <td id="list-create_time"></td>
                                </tr>
                                <tr>
                                    <td>私信内容：</td>
                                    <td id="list-message"></td>
                                </tr>
                            </table>

                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper form-inline" role="grid">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="dataTables_length" id="DataTables_Table_0_length">
                            <a data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-plus"></span> 新增</a> &nbsp;&nbsp;&nbsp;&nbsp;
                            <a  id="delete"> <span class="glyphicon glyphicon-trash"></span>  删除</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                            <button  name="all" id="checkboxAll"  class="btn btn-primary btn-sm" type="button"><i class="fa fa-check"></i>&nbsp;全选</button>
                            <button  name="no"  id="checkedNo" class="btn btn-danger btn-sm" type="button"><i class="glyphicon glyphicon-remove"></i>&nbsp;全不选</button>
                            <button  name="reverse"id="checkedRev"  class="btn btn-default btn-sm" type="button"><i class="glyphicon glyphicon-random"></i>&nbsp;反选</button>
                            <a  href="" class="btn btn-warning  btn-sm "><i class="glyphicon glyphicon-refresh"></i>  重置 / 刷新</a>
                            <p></p>

                            <!--bootstrap-->

                            <div role="form" class=" form-group-sm"  style="width: 650px;"  >
                                <label>关键字&nbsp;&nbsp;</label>
                                <div class="form-group">
                                    <label for="exampleInputEmail2" class="sr-only" >用户名</label>
                                    <input type="text" placeholder="关键字" id="exampleInputEmail2" class="form-control" name="name" >
                                </div>
                                <div class="form-group">
                                    <div class="form-group" id="data_5">
                                        <div class="input-daterange input-group" id="datepicker">
                                            <input type="text" class="input-sm form-control" name="start" value="{:date('Y-m-d')}"  readonly style="background: white"  id="start" />
                                            <span class="input-group-addon">到</span>
                                            <input type="text" class="input-sm form-control" name="end" value="{:date('Y-m-d',time()+86400)}" readonly  style="background: white"  id="end" />
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-white btn-sm" id="select">查询</button>
                            </div>
                            <br>


                        </div>
                    </div>

                </div>
                <table class="table table-striped table-bordered table-hover dataTables-example dataTable" id="DataTables_Table_0" aria-describedby="DataTables_Table_0_info">

                    <thead >
                    <tr role="row">
                        <th class="sorting_asc_disabled" tabindex="0" aria-controls="DataTables_Table_0"  style="width: 30px;">
                            <div class="text-center">
                                <input type="checkbox" disabled >
                            </div>

                        </th>
                        <th class="sorting_asc_disabled text-center" tabindex="0" >收件人</th>
                        <th class="sorting_asc_disabled text-center"  >私信内容</th>
                        <th class="sorting_asc_disabled text-center"  >发件人</th>
                        <th class="sorting_asc_disabled text-center"  >是否已读</th>
                        <th class="sorting_asc_disabled text-center"  >创建时间</th>
                        <th class="sorting_asc_disabled text-center"  >详情</th>
                    </thead>
                    <tbody id="ok-create">
                    {volist name='data' id='value'}
                    <tr class="gradeA odd  {$value.id}  select-remove">
                        <td class="sorting_1">
                            <div class="text-center">
                                <input type="checkbox" name="check[]"  yang="yang"  value="{$value.id}" >
                            </div>
                        </td>
                        <td class="text-center  ">{$value.staff_name}</td>
                        <td class="text-center">{if condition=' :mb_strlen(strip_tags($value.message)) gt 10 '  }{:mb_substr(strip_tags($value.message),0,10)}...{else /}{:strip_tags($value.message)}{/if}</td>
                        <td class="text-center  ">{$value.send_name}</td>
                        <td class="text-center">{$value.isread}</td>
                        <td class="text-center  ">{$value.create_time}</td>
                        <td class="text-center">
                            <a class="details"   details_id="{$value.id}"><i class="fa fa-file-text-o"></i>  </a>
                        </td>
                    </tr>
                    {/volist}
                    </tbody>
                </table>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="text-right" id="page">

                        </div>
                    </div>

                </div>


            </div>
            <!--jquery 全选，不全选，反选...-->
            <script>


                UE.getEditor('content',{initialFrameWidth:680,initialFrameHeight:200,});
                //
                $("#test").click(function () {
                    $("#myModal").modal('hide');
                    $("#product").modal('show');
                });

                $("#add-ok").on('click','.documentary',function () {
                    $('#allo').val( $(this).parents(":eq(0)").children(':eq(2)').html());
                    $("#allo").attr('allo_id', $(this).parents(":eq(0)").children().html())


                    $("#product").modal('hide');
                    $("#myModal").modal('show');
                });


                $("#ok-create").on('click','.details',function () {
                    var yang=this;
                    $.ajax({
                        type:'GET',
                        url:'letter/'+$(this).attr('details_id')+'/edit',
                        data:{
                            id:$(this).attr('details_id'),
                        },
                        beforeSend:function(){
                            $('#ok').modal('show');
                        },
                        success:function (response,stutas,xhr) {
                            $('#myModalss').modal('show');
                            $('#ok').modal('hide');
                            $('#list-send_name').html(response['send_name']);
                            $('#list-create_time').html(response['create_time']);
                            $("#list-message").html(response['message']);
                            $(yang).parents(":eq(1)").children(":eq(4)").html('已读');
                            setTimeout(function () {
                                $('#ok-img').attr('src', '/__IMG__/loading.gif');
                                $('#ok-text').html('数据交互中..,');
                            }, 1000)
                        }
                    });

                });





                $(function() {  //prop和attr方法都是设置或者修改被选元素的属性，
                    // prop方法用于HTML元素本身就带有的固有属性，
                    // attr方法用于HTML元素自己定义的dom属性，

                    $("#checkedAll").click(function() {

                        if (this.checked) {

                            $("[yang=yang]:checkbox").prop("checked", true);
                        }else {

                            $("[yang=yang]:checkbox").prop("checked", false);
                        }
                    });

                    $("#checkboxAll").click(function() {

                        $("[yang=yang]:checkbox").prop("checked", true);
                    });

                    $("#checkedNo").click(function() {

                        $("[yang=yang]:checkbox").prop("checked", false);
                    });

                    $("#checkedRev").click(function() {

                        $("[yang=yang]:checkbox").each(function() {
                            console.log(this.checked);
                            this.checked = !this.checked//this指当前的html对象
                        });
                    });

                    $("#submit").click(function() {

                        var str = "你喜欢的是："
                        $("[yang=yang]:checkbox:checked").each(function() {

                            str += $(this).val() + "||";//这里$(this)指的是jquery对象
                        })

                        console.log(str);
                    });
                })

            </script>
            <script>
                //add
                $('#submit').click(function () {
                    $.ajax({
                        url:'letter',
                        type:'POST',
                        data:{
                            staff_name:$("#allo").val(),
                            staff_id:$("#allo").attr('allo_id'),
                            message:UE.getEditor('content').getContent(),
                        },
                        beforeSend:function(){
                            $('#ok').modal('show');
                            $('#myModal').modal('hide');
                        },
                        success:function (r,s,x) {
                            if (r){
                                //计算长度
                                var str=UE.getEditor('content').getContent();
                                var dd=str.replace(/<\/?.+?>/g,"");
                                var dds=dd.replace(/ /g,"");//dds为得到后的内容
                                if (dds.length>10){
                                      var messages= dds.substr(0,10)+'...';
                                }else
                                {
                                    var messages=dds;
                                }
                                
                                $('#ok-img').attr('src', '/__IMG__/jump_success.png');
                                $('#ok-text').html('数据添加成功');

                                $('#ok-create').prepend(' <tr class="gradeA odd  '+r+'  select-remove">\n' +
                                    '                        <td class="sorting_1">\n' +
                                    '                            <div class="text-center">\n' +
                                    '                                <input type="checkbox" name="check[]"  yang="yang"  value="'+r+'" >\n' +
                                    '                            </div>\n' +
                                    '                        </td>\n' +
                                    '                        <td class="text-center  ">'+$("#allo").val()+'</td>\n' +
                                    '                        <td class="text-center">'+messages+'</td>\n' +
                                    '                        <td class="text-center  ">{:session("name")}</td>\n' +
                                    '                        <td class="text-center">未读</td>\n' +
                                    '                        <td class="text-center  ">{:date("Y-m-d H:i:s")}</td>\n' +
                                    '                        <td class="text-center">\n' +
                                    '                            <a class="details"   details_id="'+r+'"><i class="fa fa-file-text-o"></i>  </a>\n' +
                                    '                        </td>\n' +
                                    '                    </tr>');
                                setTimeout(function () {
                                    $('#ok').modal('hide');
                                    $('#ok-img').attr('src', '/__IMG__/loading.gif');
                                    $('#ok-text').html('数据交互中..,');
                                }, 1000)
                            }
                        }
                    })

                });


                //delete
                $("#delete").click(function(){
                    if ($("[yang=yang]:checkbox:checked").length>0){
                        var delete_id=[];
                        var i=0;
                        $.each($("[yang=yang]:checkbox:checked"),function(){
                            if(this.checked){
                                delete_id[i]=$(this).val();
                                i++;
                            }
                        });
                        var num=JSON.stringify((delete_id));
                        $.ajax({
                            type:'DELETE',
                            url:'letter/delete',
                            data:{
                                id:num,
                            },
                            beforeSend:function(){
                                $('#ok').modal('show');
                            },
                            success:function (response,stutas,xhr) {
                                if(response==true){
                                    $('#ok-img').attr('src','/__IMG__/jump_success.png');
                                    $('#ok-text').html('数据删除成功');
                                    $("[yang=yang]:checkbox:checked").parent().parent().parent().hide();
                                    setTimeout(function () {
                                        $("[yang=yang]:checkbox:checked").attr('checked',false);
                                        $('#ok').modal('hide');
                                        $('#ok-img').attr('src','/__IMG__/loading.gif');
                                        $('#ok-text').html('数据交互中..,');
                                    },1000)
                                }

                            }
                        })
                    }else {
                        alert('至少有一个选中');
                    }
                });
            </script>
            {include file='layout/footer'}